---
applyTo: "*.php"
title: PHP Coding Standards
description: |
  Coding standards for PHP files in this repository.
---
# Copilot instructions for PHP files

## Context
- This repository is a Laravel application.
- This repository uses PHP 8.2 or higher.
- This repository uses Laravel 12 or higher.
- This repository follows the Laravel standard.
- This repository adheres to the PSR-12 coding standard.
- This laravel application defines a REST API.
- This laravel application uses resource controllers.
- This laravel application uses Eloquent ORM.
- This laravel application uses migrations for database schema.
- This laravel application uses factories for testing.
- This laravel application uses seeders for database seeding.
- This laravel application uses PHPUnit for testing.
- This laravel application uses Laravel's built-in validation.
- This laravel application uses Laravel's built-in authentication.
- This repository uses GitHub for version control.

## Standards
- This repository is a Laravel application.
- This repository uses PHP 8.2 or higher.
- This repository follows the Laravel standard.
- This repository adheres to the PSR-12 coding standard.
- This repository uses the PSR-4 autoloading standard.
- This repository uses Pint for code formatting and style checking.

## Naming Conventions
- Always comply with Laravel's naming conventions.
- Use `snake_case` for database columns and table names.
- Use `kebab-case` for URLs and routes.
- Use `snake_case` for configuration files.
- Use `camelCase` for variable and function names.
- Use `PascalCase` for class names and methods.
- Use `UPPER_CASE` for constants.

## Testing the API
- Use PHPUnit for testing.
- Use the `tests/Feature` directory for API tests.
- Use `php artisan make:test` to create new test classes.
- All tests classes shall contain `use RefreshDatabase, WithFaker;` to insure proper isolation and data generation.
  - This line is to be placed first inside the class declaration.
  - For example:
    ```php
    use Illuminate\Foundation\Testing\RefreshDatabase;
    use Illuminate\Foundation\Testing\WithFaker;
    use Tests\TestCase;

    class MyModelTest extends TestCase
    {
        use RefreshDatabase, WithFaker;
    }
    ```
- Use `php artisan test` to run tests.
- Use `php artisan test --coverage` to generate a code coverage report.
- Test every route in the `routes/api.php` file.
- Test names should be descriptive and follow the format:
  `test_api_[Category]_[ControllerMethod]_[Scenario]`.
- Group tests related to directly related Model, Resource, Factory, 
  Controller and Route in a single test class.
  - For example, if you have a `User` model, create a `UserTest` class
    that tests the `User` model, the `UserFactory` factory, the
    `UserResource` resource, the `UserController` controller, and the
    routes defined in `routes/api.php` that interact with the `UserController`.
- Ensure that tests are concise and focused on a single aspect of the functionality.
- Use the `assert` methods provided by PHPUnit to validate the expected outcomes.
- Always use the `route()` helper to generate URLs for testing.
- When using the `route()` helper, ensure that the route name is used correctly. 
  - Route names are defined in the `routes/api.php` file.
  - Route names autogenerated by the Resource controllers comply with Laravel's naming conventions:
    - the name of the route is the singular form of the model's database table, followed by the action.
    - For example, for the `UserResource` (based on the `User` model), the name of the database table is `users` and the name of the route is `user`:
      - `user.index` for the index method
      - `user.show` for the show method
      - `user.store` for the store method
      - `user.update` for the update method
      - `user.destroy` for the destroy method
- Categorize tests according to the process they are testing.
  - Tests related to the Factory are in the category 'Factory'.
    - For every factory, make a distinct test to assert that the factory creates the expected data
      - The name of this test should follow the format `test_factory`.
    - For every factory method, make a distinct test to assert that the factory creates the expected data.
      - The name of this test should follow the format `test_factory_[FactoryMethod]`.
      - For example, if the `UserFactory` has a method `withEmail`, then all tests related to the factory must be repeated with the `withEmail` method.
        - The name of these tests should follow the format `test_factory_withEmail`.
  - Tests related to the HTTP responses are in the category 'Response'.
    - For every response make a distinct test to assert the status code of the response.
      - The name of this test should follow the format `test_api_response_[ControllerMethod]_returns_[StatusCode]_on_[Scenario]`.
    - For every response make a distinct test to assert the structure of the response.
      - The name of this test should follow the format `test_api_response_[ControllerMethod]_returns_the_expected_structure`.
    - For every response make a distinct test to assert the content of the response.
      - The name of this test should follow the format `test_api_response_[ControllerMethod]_returns_the_expected_data`.
    - Prefer the Response tests to use the `assertJsonStructure` to validate the response structure.
    # - Prefer the Response tests to use the `assertJsonPath` methods to validate the response content, when the response has a single item.
    # - Prefer the Response tests to use the `assertJson` methods to validate the response content, when the response has multiple items.
    - Prefer the Response tests to use the `assertJsonPath` methods to validate the response content
    - Prefer the methods `assertOk`, `assertCreated`, `assertNoContent`, `assertNotFound`, and `assertUnprocessableEntity` to validate the status code of the response.
  - Tests related to the validation of the request data are in the category 'Validation'.
    - For every `store` and `update` method, make a distinct test to assert that input validation is performed.
      - The name of this test should follow the format `test_api_validation_[ControllerMethod]_validates_its_input`.
  - Tests related to the authentication and authorization are in the category 'Authentication'.
    - For every route make a distinct test to assert that authenticated access is allowed.
      - The name of this test should follow the format `test_api_authentication_[ControllerMethod]_allows_authenticated_users`.
    - For every route make a distinct test to assert that anonymous access is forbidden.
      - The name of this test should follow the format `test_api_authentication_[ControllerMethod]_forbids_anonymous_access`.
  - Tests related to the process performed by the controller are in the category 'Process'.
    - For every `store`, `update` and `destroy` method, make a distinct test to assert that the underlying database record is impacted.
      - The name of this test should follow the format `test_api_process_[ControllerMethod]_[creates|updates|deletes]_a_row`.
  - When the factory has extra methods, all HTTP Response tests may be repeated with the extra methods.
    - For example:
        - `test_api_response_[ControllerMethod]_[extra_method]_returns_[StatusCode]_on_[Scenario]` 
        - `test_api_response_[ControllerMethod]_[extra_method]_returns_the_expected_structure`
        - `test_api_response_[ControllerMethod]_[extra_method]_returns_the_expected_data`
  - For example, the `User` model has a `UserResource`, `UserFactory` and `UserController`.
    The `UserFactory` has one method: `withEmail`.
    The `UserController` has five methods: `index`, `show`, `store`, `update`, `destroy`.
    The test case shall include all of the following tests:
    - `test_factory`.
    - `test_factory_withEmail`.
    - `test_api_authentication_index_allows_authenticated_users`.
    - `test_api_authentication_index_forbids_anonymous_access`.
    - `test_api_authentication_show_allows_authenticated_users`.
    - `test_api_authentication_show_forbids_anonymous_access`.
    - `test_api_authentication_store_allows_authenticated_users`.
    - `test_api_authentication_store_forbids_anonymous_access`.
    - `test_api_authentication_update_allows_authenticated_users`.
    - `test_api_authentication_update_forbids_anonymous_access`.
    - `test_api_authentication_destroy_allows_authenticated_users`.
    - `test_api_authentication_destroy_forbids_anonymous_access`.
    - `test_api_process_index_returns_all_rows`.
    - `test_api_process_show_returns_one_row`.
    - `test_api_process_store_creates_a_row`.
    - `test_api_process_update_updates_a_row`.
    - `test_api_process_destroy_deletes_a_row`.
    - `test_api_response_index_returns_ok_on_success`.
    - `test_api_response_show_returns_ok_on_success`.
    - `test_api_response_show_returns_not_found_when_record_does_not_exist`.
    - `test_api_response_store_returns_created_on_success`.
    - `test_api_response_store_returns_unprocessable_entity_when_input_is_invalid`.
    - `test_api_response_update_returns_ok_on_success`.
    - `test_api_response_update_returns_not_found_when_record_does_not_exist`.
    - `test_api_response_update_returns_unprocessable_entity_when_input_is_invalid`.
    - `test_api_response_destroy_returns_no_content_on_success`.
    - `test_api_response_destroy_returns_not_found_when_record_does_not_exist`.
    - `test_api_response_index_returns_the_expected_structure`.
    - `test_api_response_show_returns_the_expected_structure`.
    - `test_api_response_store_returns_the_expected_structure`.
    - `test_api_response_update_returns_the_expected_structure`.
    - `test_api_response_destroy_returns_the_expected_structure`.
    - `test_api_response_index_returns_the_expected_data`.
    - `test_api_response_show_returns_the_expected_data`.
    - `test_api_response_store_returns_the_expected_data`.
    - `test_api_response_update_returns_the_expected_data`.
    - `test_api_response_destroy_returns_the_expected_data`.
    - `test_api_validation_store_validates_its_input`.
    - `test_api_validation_update_validates_its_input`.
- When testing a route that requires authentication, use the `actingAs` method to simulate an authenticated user.
  - use the User factory to create a user before calling `actingAs`.
  - For example:
    ```php
    $user = User::factory()->create();
    $this->actingAs($user);
    ```

## Error Handling
- Use try-catch blocks for asynchronous operations.
- Always log errors with meaningful messages.
- Always handle exceptions gracefully.

## Annotation
- Use PHPDoc for class and method annotations.
- Use Laravel's built-in validation annotations for request validation.
- Use dedoc/Scramble annotations for Controller methods.
- When adding annotations, ensure they are clear and concise.
- When adding annotations, explain the purpose of that annotation.

## Code Comments
- Use comments to explain complex logic.
- Use comments to clarify the purpose of a function or method.


---
applyTo: pull_request
title: Copilot Instructions
description: |
  Instructions for using GitHub Copilot in this repository.
---
# GitHub Copilot Instructions

## Context
- This repository is a Laravel application.
- This repository uses PHP 8.2 or higher.
- This repository follows the Laravel standard.
- This repository adheres to the PSR-12 coding standard.
- This repository uses GitHub for version control.
- Our team uses GitHub issues to track bugs and feature requests.
- When providing code samples or instructions, please ensure that they are clear and concise, and that they address the specific issue or feature request being discussed.
- When reviewing pull requests, ensure that the git commits and PR include a clear description of the changes.
- When reviewing pull requests, ensure that the git commits and PR include references to relevant issues or discussions.